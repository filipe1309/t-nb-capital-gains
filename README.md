
<a name="readme-top"></a>

# <p align="center">Capital Gains CLI Calculator</p>

<p align="center">
    <img src="https://img.shields.io/badge/Code-Go-informational?style=flat-square&logo=go&color=00ADD8" alt="Go" />
    <img src="https://img.shields.io/badge/Tools-Docker-informational?style=flat-square&logo=docker&color=2496ED" alt="Docker" />
</p>

## ðŸ’¬ About

Capital Gains CLI Calculator allows you to calculate the capital gains tax of one or more transactions. The transactions are read from the standard input and the result is printed to the standard output.

Each transaction is a list of operations. Each operation has the following fields:
- `operation`: buy or sell
- `unit-cost`: the unit cost of the operation
- `quantity`: the quantity of the operation

Example of input:
```json
[{"operation":"buy","unit-cost":10.00,"quantity":100},{"operation":"sell","unit-cost":15.00,"quantity":50},{"operation":"sell","unit-cost":15.00,"quantity":50}]
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":20.00,"quantity":5000},{"operation":"sell","unit-cost":5.00,"quantity":5000}]
```

Example of output:
```json
[{"tax":0.00},{"tax":0.00},{"tax":0.00}]
[{"tax":0.00},{"tax":10000.00},{"tax":0.00}]
```

### :open_file_folder: Project Organization

- `cmd/cli/capital-gains/main.go`: contains the entrypoint of the application
- `internal/application`: contains the services
- `internal/domain`: contains the business logic and interfaces
- `internal/infrastructure`: contains the adapters
- `internal/utils`: contains the utility functions
- `internal/application/testdata`: contains the test data
- `bin`: contains the binary file generated by the build command

### :pushpin: Decisions

I've chosen Go as the programming language because it is a simple and powerful language, 
and it suits very well for CLI applications, been very efficient, and easy to build and 
run in different environments.

As the requirements are simple, I decided to use the hexagonal architecture to separate 
the business logic from the infrastructure. This way, it is easier to test the application 
and to change the implementation of the services.

To facilitate the build and run commands, I've created a Makefile with the most common
commands. Also, the Dockerfile was created with a multi-stage build to generate a smaller image, 
and to facilitate the deployment of the application in different environments.


### :pushpin: Features
- [x] Dockerfile with multi-stage docker build
- [x] Utils package
- [x] Makefile: to simplify the build and run commands
- [x] Hexagonal architecture
- [x] Strategy Pattern: `OperationStrategy` interface, you can implement your own strategy to calculate the capital gains tax of a transaction
- [x] Testify for unit tests

### :pushpin: To Do
- [ ] Add integration tests
- [ ] Add more strategies
- [ ] Add more input validations


## :computer: Technologies

- [Go](https://golang.org/)
- [Testify](http://github.com/stretchr/testify)
- [Docker](https://www.docker.com/)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## :scroll: Requirements

### Build/Run with Docker

- [Docker](https://www.docker.com/)

### Build/Run Locally

- [Go](https://golang.org/)

> [!NOTE]
> You need to have Go (> 1.18) installed in your machine to build, run and test the application locally

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## :cd: Installation

```sh
git clone git@github.com:filipe1309/t-nb-capital-gains.git
```

```sh
cd t-nb-capital-gains
```

### :whale: Docker

```sh
make docker-build
```
> The docker image `capital-gains:1` will be created

### :hammer: Build (build locally)

```sh
make build
```
> The binary will be created in the `bin` folder

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## :runner: Running

### :whale: Docker

```sh
make docker-run < input.txt
```

### :hammer: Build (run locally)

```sh
make run < input.txt
```
OR
```sh
make run # hit enter and type the transactions
[{"operation":"buy",...
# hit enter again to calculate the capital gains tax
```

> [!NOTE]
> You can use any file with `.input` extension in the `internal/application/testdata` folder

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## :white_check_mark: Tests

```sh
make test
```
> It will run the unit tests and generate the coverage report as `cp.out` and `coverage.html`

## :clap: Acknowledgments

- [Hexagonal Architecture, Ports and Adapters in Go](https://medium.com/@kyodo-tech/hexagonal-architecture-ports-and-adapters-in-go-f1af950726b)

<p align="right">(<a href="#readme-top">back to top</a>)</p>
